<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>Sketchviz</title>

        <!-- bootstrap -->
        <script src="https://code.jquery.com/jquery-3.4.1.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

        <!-- JSmol -->
        <script type="text/javascript" src="jsmol/JSmol.min.nojq.js"></script>

        <script defer type="text/javascript" src="sketchviz.min.js"></script>
    </head>

    <body>
        <header style="padding: 1em 0; margin-bottom: 2em;">
            <h1 style="text-align: center">Sketchmap vizualization</h1>
        </header>
        <div class="container">
            <div class="input-group input-group-bg" style="margin: auto">
                <div class="input-group-prepend">
                    <label class="input-group-text" for=skv-shape>Select a system</label>
                </div>
                <select id=select-system class="custom-select">
                    <option value="Arginine-Dipeptide" selected>Arginine-Dipeptide</option>
                    <option value="Pyrole" selected>Pyrole</option>
                    <option value="Qm7b" selected>Qm7b</option>
                </select>
            </div>

            <div style="height: 2em"></div>
            <div class="row">
                <div class="col-xl-7">
                    <div id=skviz-map style="height: 100%"></div>
                </div>

                <div class="col-xl-5">
                    <div id=skviz-viewer style="height: 60%"></div>
                    <div id=skviz-slider></div>
                </div>
            </div>
        </div>
    </body>

    <script>
        const system = document.getElementById('select-system');
        system.onchange = () => {
            // we have to reload since jsmol & plotly do not interact nicely
            // with WebGL state. jsmol using .caller all over the place and
            // thus throwing exceptions with plotly 'use strict' do not help
            // either
            window.location.reload(false);
        }

        document.addEventListener("DOMContentLoaded", () => {
            const name = system.value;
            fetch(`${name}.json`)
                .then(response => response.json())
                .then(json => {
                    Sketchviz.setup({
                        name: name,
                        properties: json.sketchmap,
                        structures: json.structures,
                        mapId: 'skviz-map',
                        viewerId: 'skviz-viewer',
                        j2sPath: 'jsmol/j2s',
                    })
                })
                .catch(e => console.error(e));
        });
    </script>
</html>
